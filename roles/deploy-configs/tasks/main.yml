---
# tasks file for deploy-configs
- name: find if tar file exists
  stat:
   path: /etc/hadoop-3.1.3.tar.gz
  register: path_exists
  tags:
   - deploy_hadoop
- name: find if dir exists
  stat:
   path: /etc/hadoop-3.1.3
  register: dir_exists
  tags:
   - deploy-hadoop
- name: install tar file
  get_url:
   url: "http://apache.cs.utah.edu/hadoop/common/current/hadoop-3.1.3.tar.gz"
   force: yes
   unsafe_writes: yes
   validate_certs: no
   dest: /etc
   owner: hadoop
   group: hadoop
  tags:
   - deploy-hadoop
#  when: not path_exists.stat.exists
- name: uncompress tar
  unarchive:
   src: /etc/hadoop-3.1.3.tar.gz
   dest: /etc
   owner: hadoop
   group: hadoop
   remote_src: yes
  when: dir_exists.stat.exists == False
  tags:
   - deploy-hadoop
- name: permissions
  file:
   path: /etc/hadoop-3.1.3
   state: directory
   recurse: yes
   owner: hadoop
   group: hadoop
   mode: 0755
  tags:
   - deploy-hadoop
- name: create link
  file:
   src: /etc/hadoop-3.1.3
   dest: /etc/hadoop
   owner: hadoop
   group: hadoop
   mode: 0755
   state: link
  tags:
   - deploy-hadoop
- name: permissions for link
  file:
   path: /etc/hadoop
   state: directory
   recurse: yes
   owner: hadoop
   group: hadoop
   mode: 0755
  tags:
   - deploy-hadoop
- name: find if zk tar file exists
  stat:
   path: /etc/apache-zookeeper-3.6.1.tar.gz
  register: zk_file_exists
  tags:
   - deploy-zk
- name: find if zk dir exists
  stat:
   path: /etc/apache-zookeeper-3.6.1
  register: zk_dir_exists
  tags:
   - deploy-zk
- name: install tar file
  get_url:
   url: "https://archive.apache.org/dist/zookeeper/zookeeper-3.6.1/apache-zookeeper-3.6.1.tar.gz"
   force: yes
   unsafe_writes: yes
   validate_certs: no
   dest: /etc
   owner: hadoop
   group: hadoop
  when: zk_file_exists.stat.exists == false
  tags:
   - deploy-zk
- name: uncompress tar
  unarchive:
   src: /etc/apache-zookeeper-3.6.1.tar.gz
   dest: /etc
   owner: hadoop
   group: hadoop
   remote_src: yes
  when: zk_dir_exists.stat.exists == false
  tags:
   - deploy-zk
- name: permissions
  file:
   path: /etc/apache-zookeeper-3.6.1
   state: directory
   recurse: yes
   owner: hadoop
   mode: 0755
  tags:
   - deploy-zk
- name: create link
  file:
   src: /etc/apache-zookeeper-3.6.1
   dest: /etc/zk
   owner: hadoop
   group: hadoop
   mode: 0755
   state: link
  tags:
   - deploy-zk
- name: permissions for link
  file:
   path: /etc/zk
   state: directory
   recurse: yes
   owner: hadoop
   group: hadoop
   mode: 0755
  tags:
   - deploy-zk
